# Test info

- Name: e2e+api
- Location: C:\Users\User\Documents\k6try\tests\api.spec.ts:149:6

# Error details

```
Error: expect(received).toBe(expected) // Object.is equality

Expected: 0
Received: 64
    at FlowPage.e2e (C:\Users\User\Documents\k6try\pages\FlowPage.ts:397:15)
    at C:\Users\User\Documents\k6try\tests\api.spec.ts:159:5
    at C:\Users\User\Documents\k6try\tests\api.spec.ts:154:3
```

# Page snapshot

```yaml
- complementary:
  - button " עזרה":
    - text: 
    - paragraph: עזרה
  - button " חזרה לדף הבית":
    - text: 
    - paragraph: חזרה לדף הבית
  - link "":
    - /url: "#/userLinks/D4A203FC8B8C4F11B114"
    - button ""
  - text: 1.0.0.94
- main:
  - text: מספר האירועים שהוקמו 64
  - grid "טבלת נתונים":
    - toolbar "Data grid toolbar":
      - button "בחירת עמודה": 
    - row "טור לעריכה טור שם האירוע טור בחירת מודל טור תקופה טור יחידה טור סמכות טור מקים טור תפקיד המקים טור No-Text potentialActual טור סטטוס האירוע טור תאריך התחלה וסיום טור מחיקת אירוע":
      - columnheader "טור לעריכה": לעריכה
      - columnheader "טור שם האירוע": שם האירוע
      - columnheader "טור בחירת מודל": בחירת מודל
      - columnheader "טור תקופה": תקופה
      - columnheader "טור יחידה": יחידה
      - columnheader "טור סמכות": סמכות
      - columnheader "טור מקים": מקים
      - columnheader "טור תפקיד המקים": תפקיד המקים
      - columnheader "טור No-Text potentialActual": No-Text potentialActual
      - columnheader "טור סטטוס האירוע": סטטוס האירוע
      - columnheader "טור תאריך התחלה וסיום": תאריך התחלה וסיום
      - columnheader "טור מחיקת אירוע": מחיקת אירוע
    - row "תא סינון תא סינון תא סינון תא סינון תא סינון תא סינון תא סינון תא סינון תא סינון תא סינון":
      - gridcell
      - gridcell "תא סינון":
        - menubar:
          - menuitem ""
        - textbox "תא סינון"
      - gridcell "תא סינון":
        - menubar:
          - menuitem ""
        - textbox "תא סינון"
      - gridcell "תא סינון":
        - menubar:
          - menuitem ""
        - textbox "תא סינון"
      - gridcell "תא סינון":
        - menubar:
          - menuitem ""
        - textbox "תא סינון"
      - gridcell "תא סינון":
        - menubar:
          - menuitem ""
        - textbox "תא סינון"
      - gridcell "תא סינון":
        - textbox "תא סינון"
      - gridcell "תא סינון":
        - textbox "תא סינון"
      - gridcell "תא סינון":
        - menubar:
          - menuitem ""
        - spinbutton "תא סינון"
      - gridcell "תא סינון":
        - menubar:
          - menuitem ""
        - textbox "תא סינון"
      - gridcell "תא סינון":
        - menubar:
          - menuitem ""
        - textbox "תא סינון"
      - gridcell
    - row "540. מרינה 2025 עונת 1 248. פיקוד 1 כללי ניהול פוטנציאל = 0 בהכנה 26/05/2025 26/05/2025 ":
      - gridcell
      - gridcell "540. מרינה 2025"
      - gridcell
      - gridcell "עונת 1"
      - gridcell "248. פיקוד 1"
      - gridcell "כללי"
      - gridcell
      - gridcell
      - gridcell "ניהול פוטנציאל = 0"
      - gridcell "בהכנה"
      - gridcell "26/05/2025 26/05/2025"
      - gridcell "":
        - button ""
    - row "541. מרינה 2025 עונת 1 248. פיקוד 1 כללי ניהול פוטנציאל = 19343 מעריכים בפועל = 0 מעריכים לא תקינים = 0 מעריכים פסולים = 0 שאלונים מאושרים = 0 בהכנה 26/05/2025 26/05/2025 ":
      - gridcell
      - gridcell "541. מרינה 2025"
      - gridcell
      - gridcell "עונת 1"
      - gridcell "248. פיקוד 1"
      - gridcell "כללי"
      - gridcell
      - gridcell
      - gridcell "ניהול פוטנציאל = 19343 מעריכים בפועל = 0 מעריכים לא תקינים = 0 מעריכים פסולים = 0 שאלונים מאושרים = 0"
      - gridcell "בהכנה"
      - gridcell "26/05/2025 26/05/2025"
      - gridcell "":
        - button ""
    - 'row "542. מרינה 2025 0 2. צה`ל ניהול פוטנציאל = 0 בהכנה "':
      - gridcell
      - gridcell "542. מרינה 2025"
      - gridcell
      - gridcell "0"
      - 'gridcell "2. צה`ל"'
      - gridcell
      - gridcell
      - gridcell
      - gridcell "ניהול פוטנציאל = 0"
      - gridcell "בהכנה"
      - gridcell
      - gridcell "":
        - button ""
    - 'row "543. 0 2. צה`ל ניהול פוטנציאל = 0 בהכנה "':
      - gridcell
      - gridcell "543."
      - gridcell
      - gridcell "0"
      - 'gridcell "2. צה`ל"'
      - gridcell
      - gridcell
      - gridcell
      - gridcell "ניהול פוטנציאל = 0"
      - gridcell "בהכנה"
      - gridcell
      - gridcell "":
        - button ""
    - button "Page 7": "7"
    - button "Page 6": "6"
    - button "Page 5": "5"
    - button "Page 4": "4"
    - button "Page 3": "3"
    - button "Page 2": "2"
    - button "Page 1": "1"
    - text: טוען...
  - button "להקמת אירוע חדש"
```

# Test source

```ts
  297 |
  298 |     const screenshotPath = path.resolve(`C:\\Users\\User\\Documents\\k6try\\screenshots\\twohalve_actual_${i}.png`);
  299 |     const expectedPath = path.resolve(`C:\\Users\\User\\Documents\\k6try\\screenshots\\twohalve_${i}.png`);
  300 |
  301 |     const width = await this.page.evaluate(() => window.innerWidth);
  302 |     const height = await this.page.evaluate(() => window.innerHeight);
  303 |     
  304 |     
  305 |     await this.page.screenshot({ path: screenshotPath, clip: { x: 0, y: 0, width, height } });
  306 |
  307 |     const expectedImage = PNG.sync.read(fs.readFileSync(expectedPath));
  308 |     const actualImage = PNG.sync.read(fs.readFileSync(screenshotPath));
  309 |
  310 |     const { width: w, height: h } = expectedImage;
  311 |     const diff = new PNG({ width: w, height: h });
  312 |
  313 |     const diffPixels = pixelmatch(expectedImage.data, actualImage.data, diff.data, w, h, { threshold: 0.1 });
  314 |
  315 |     const TOLERANCE = 100;
  316 |
  317 |     expect(diffPixels, `יש הבדל של ${diffPixels} פיקסלים בין התמונה הצפויה לפועלית במסך מספר ${i}`).toBeLessThanOrEqual(TOLERANCE);
  318 |
  319 |
  320 |     await this.page.goBack();
  321 |   }
  322 | }
  323 | async captureExpectedScreenshots(start: number, end: number) {
  324 |   for (let i = start; i <= end; i++) {
  325 |     await this.all.nth(i).click();
  326 |
  327 |     const width = await this.page.evaluate(() => window.innerWidth);
  328 |     const height = await this.page.evaluate(() => window.innerHeight);
  329 |
  330 |     const screenshotPath = path.resolve(`C:\\Users\\User\\Documents\\k6try\\screenshots\\twohalve_${i}.png`);
  331 |
  332 |     await this.page.screenshot({
  333 |       path: screenshotPath,
  334 |       clip: {
  335 |         x: 0,
  336 |         y: 0,
  337 |         width,
  338 |         height
  339 |       }
  340 |     });
  341 |
  342 |     console.log(`✔️ נשמרה תמונת expected לעמוד ${i}: ${screenshotPath}`);
  343 |
  344 |     await this.page.goBack();
  345 |   }
  346 | }
  347 |
  348 | async e2e() {
  349 |   // 1. פותחים את העמוד (שגורם לקריאת ה-API)
  350 |   await this.eventManagementButton.click();
  351 |
  352 |   // 2. מחכים במקביל לתגובה מה-API
  353 |   const [response] = await Promise.all([
  354 |     this.page.waitForResponse(resp =>
  355 |       resp.url().includes('/TPSMOH.API/api/servicecall') &&
  356 |       resp.request().method() === 'POST' &&
  357 |       resp.status() === 200
  358 |     ),
  359 |     // אין צורך בפעולה נוספת כאן כי הלחיצה מפעילה את הקריאה
  360 |   ]);
  361 |
  362 |   // 3. קוראים את ה-API
  363 |   const apiResults = await response.json();
  364 |   console.log(apiResults)
  365 |
  366 |   // שולף את כל השדות eventId מכל מקום במבנה
  367 |   const eventIds = apiResults.calls
  368 |   .filter(call =>
  369 |     call.methodName === 'getList' &&
  370 |     call.parameters?.entityName === 'TSmEventsList' &&
  371 |     call.parameters?.forSm === true &&
  372 |     Array.isArray(call.callResult?.data)
  373 |   )
  374 |   .flatMap(call => call.callResult.data)
  375 |   .filter(item => item.eventId !== undefined)
  376 |   .map(item => item.eventId);
  377 |
  378 | const backendCount = eventIds.length;
  379 |
  380 |
  381 |   
  382 |   console.log('Count from API:', backendCount);
  383 |   // 4. מחכים שהטבלה נטענת, סופרים ב-UI
  384 |   await this.page.waitForSelector("//tr[@aria-selected='false']");
  385 |   const counter = await this.tr1.count();
  386 |
  387 |   // 5. אם יש לחיצה נוספת שמשפיעה על הטבלה
  388 |   await this.page2.click();
  389 |   await this.page.waitForSelector("//tr[@aria-selected='false']");
  390 |   const counter2 = await this.tr1.count();
  391 |
  392 |   // 6. חישוב לפי הלוגיקה שלך
  393 |   const sum = 6 * counter + counter2;
  394 |   console.log('Count from UI:', sum);
  395 |
  396 |   // 7. בדיקה שהמספרים שווים
> 397 |   expect(sum).toBe(backendCount);
      |               ^ Error: expect(received).toBe(expected) // Object.is equality
  398 | }
  399 |
  400 |
  401 | }
  402 |
  403 | // .click();
  404 | // 
  405 | // 
  406 | // 
```